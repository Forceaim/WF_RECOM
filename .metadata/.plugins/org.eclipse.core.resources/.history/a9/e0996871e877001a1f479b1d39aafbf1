<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" %>
<%@ page import="com.openkm.servlet.admin.BaseServlet" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://www.openkm.com/tags/utils" prefix="u" %>
<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
  <link rel="Shortcut icon" href="favicon.ico" />
  <link rel="stylesheet" href="css/admin-style.css" type="text/css" />
  
    <link rel="Shortcut icon" href="favicon.ico" />
  <link rel="stylesheet" type="text/css" href="../css/dataTables-1.10.10/jquery.dataTables-1.10.10.min.css" />
  <link rel="stylesheet" type="text/css" href="../css/jquery-ui-1.10.3/jquery-ui-1.10.3.css" />
  <link rel="stylesheet" type="text/css" href="../css/chosen.css"/>
  <link rel="stylesheet" type="text/css" href="css/admin-style.css" />
  
  <script type="text/javascript" src="../js/jquery-1.11.3.min.js"></script>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />

  <script type="text/javascript" src="../js/utils.js"></script>
  <script type="text/javascript" src="../js/jquery-ui-1.10.3/jquery-ui-1.10.3.js"></script>
  <script type="text/javascript" src="../js/jquery.dataTables-1.10.10.min.js"></script>
  <script type="text/javascript" src="../js/chosen.jquery.js" ></script>
  <script type="text/javascript">
    $(document).ready(function() {
      $('#scroll').height($(window).height() - 21);
      
      $("#dbegin").datepicker({
          showOn: "button",
          buttonImage: "img/action/calendar.png",
          buttonImageOnly: true,
          dateFormat: "yy-mm-dd",
          defaultDate: "-1w",
          changeMonth: true,
          changeYear: true,
          numberOfMonths: 1,
          showWeek: false,
          firstDay: 1,
          onClose: function (selectedDate) {
            $("#dend").datepicker("option", "minDate", selectedDate);
            $('.ui-datepicker-trigger').css("vertical-align", "middle");
          }
        });

        $("#dend").datepicker({
          showOn: "button",
          buttonImage: "img/action/calendar.png",
          buttonImageOnly: true,
          dateFormat: "yy-mm-dd",
          changeMonth: true,
          changeYear: true,
          numberOfMonths: 1,
          showWeek: false,
          firstDay: 1,
          onClose: function (selectedDate) {
            $("#dbegin").datepicker("option", "maxDate", selectedDate);
            $('.ui-datepicker-trigger').css("vertical-align", "middle");
          }
        });

        $('.ui-datepicker-trigger').css('vertical-align', 'middle');
        $('select#user').chosen({disable_search_threshold: 10});
        $('select#action').chosen({disable_search_threshold: 10});

        $("#resetButton").click(function () {
          $('#dbegin').val("");
          $('#dend').val("");
          $('#user option:eq(0)').prop('selected', true);
          $('#action option:eq(0)').prop('selected', true);
          $('#user').trigger("chosen:updated");
          $('#action').trigger("chosen:updated");
          $('#item').val("");
        });
        

       
    });
    
    
  </script>
  <title>Statistiques</title>
</head>
<body>
  <u:constantsMap className="com.openkm.servlet.admin.StatsGraphServlet" var="StatsGraph"/>
  <c:set var="isAdmin"><%=BaseServlet.isAdmin(request)%></c:set>
  <c:choose>
    <c:when test="${isAdmin}">
      <ul id="breadcrumb">
        <li class="path">
          <a href="stats.jsp">Statistiques</a>
        </li>
        <li class="action">

          <a href="TextExtractionQueue">
            File d'attente d'extraction de texte
          </a>
        </li>
        <li class="action">
          <a href="PendingTaskQueue">
            <img src="img/action/generic.png" alt="Generic" title="Generic" style="vertical-align: middle;"/>
            File d'attente des tâches en cours
          </a>
        </li>
        <li class="action">
          <a href="StatsGraph?action=refresh">
            <img src="img/action/refresh.png" alt="Refresh" title="Refresh" name="refresh" id="refresh" style="vertical-align: middle;"/>
            Refresh
	  	  </a>
        </li>
        <li>
        	 <form action="StatsGraph" method="get">
              	<b>De</b> <input type="text" name="dbegin" id="dbegin" value="${dbeginFilter}" size="15" readonly="readonly" />
	  	  		<b>à</b> <input type="text" name="dend" id="dend" value="${dendFilter}" size="15" readonly="readonly" />
	  	  		<input type="submit" value="Filter" class="searchButton"/>
          	</form>
        </li>
      </ul>
      <br/>
      <div id="scroll" style="width: 100%; height: 100%; overflow: auto;">
          <br/>
	      <table align="center">
	        <tr>
	          <td><img src="StatsGraph?t=${StatsGraph.DOCUMENTS}"/></td>
              <td><img src="StatsGraph?t=${StatsGraph.DOCUMENTS_SIZE}"/></td>
	          <td><img src="StatsGraph?t=${StatsGraph.FOLDERS}"/></td>
	          <td><img src="StatsGraph?t=${StatsGraph.DOCUMENTS_STATUS}"></img>
	        </tr>
	      </table>
	      <table align="center">
	        <tr>
            <td><img src="StatsGraph?t=${StatsGraph.OS_MEMORY}"/></td>
            <td><img src="StatsGraph?t=${StatsGraph.JVM_MEMORY}"/></td>
            <td><img src="StatsGraph?t=${StatsGraph.DISK}"/></td>
	        </tr>
	      </table>
      </div>
    </c:when>
    <c:otherwise>
      <div class="error"><h3>Accès autorisé uniquement à l'administrateur</h3></div>
    </c:otherwise>
  </c:choose>
</body>
</html>